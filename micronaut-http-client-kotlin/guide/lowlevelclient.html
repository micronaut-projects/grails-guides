<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Low Level Client null</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut HTTP Client
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>2</strong><span>Writing the App</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/bintray.html"><strong>3</strong><span>Bintray API</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/lowlevelclient.html"><strong>4</strong><span>Low Level Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/declarativeclient.html"><strong>5</strong><span>Declarative Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/controller.html"><strong>6</strong><span>Controller</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/tests.html"><strong>7</strong><span>Test</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/testingTheApp.html"><strong>8</strong><span>Testing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClientFilter.html"><strong>9</strong><span>Http Client Filter</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/next.html"><strong>10</strong><span>Where To Go From Here?</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/bintray.html">&lt;&lt; <strong>3</strong><span>Bintray API</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/declarativeclient.html"><strong>5</strong><span>Declarative Client</span> >></a></div>
                


                <div class="project">
                    <h1>4 Low Level Client</h1>

                    <p><strong>Version:</strong> null</p>
                </div>

                

                

<h1 id="lowlevelclient">4 Low Level Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-http-client-kotlin/edit/master/src/main/docs/guide/lowlevelclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Initially, you will create a Bean which uses the low-level Client API.</p>
</div>
<div class="paragraph">
<p>Create a data class to parse the JSON response into it.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/BintrayPackage.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut

data class BintrayPackage(var name: String = "",
                          var linked: Boolean = false) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>BintrayLowLevelClient</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/BintrayLowLevelClient.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.Client
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.uri.UriTemplate
import io.reactivex.Maybe
import javax.inject.Singleton

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class BintrayLowLevelClient(@param:Client(BintrayConfiguration.BINTRAY_URL) private val httpClient: RxHttpClient, <i class="conum" data-value="2"></i><b>(2)</b>
                            bintrayConfiguration: BintrayConfiguration) { <i class="conum" data-value="3"></i><b>(3)</b>
    private val uri: String

    init {
        val path = "/api/{apiversion}/repos/{organization}/{repository}/packages"
        uri = UriTemplate.of(path).expand(bintrayConfiguration.toMap())
    }

    internal fun fetchPackages(): Maybe&lt;List&lt;BintrayPackage&gt;&gt; {
        val req = HttpRequest.GET&lt;Any&gt;(uri)  <i class="conum" data-value="4"></i><b>(4)</b>
        val flowable = httpClient.retrieve(req, Argument.of(List::class.java, BintrayPackage::class.java))  <i class="conum" data-value="5"></i><b>(5)</b>
        return flowable.firstElement() as Maybe&lt;List&lt;BintrayPackage&gt;&gt;  <i class="conum" data-value="6"></i><b>(6)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>javax.inject.Singleton</code> to designate a class a a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject <code>RxClient</code> via constructor injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the previously defined configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating HTTP Requests is easy thanks to Micronautâ€™s fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use <code>retrieve</code> to perform an HTTP request for the given request object and convert the full HTTP response&#8217;s body into the specified type. e.g. <code>List&lt;BintrayPackage&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>retrieve</code> method returns a Flowable which has a firstElement method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of <code>retrieve</code> we could have used <code>jsonStream</code>. You can use <code>jsonStream()</code> to stream arrays of type <code>application/json</code> or
JSON streams of type <code>application/x-json-stream</code>. If we use <code>retrieve</code>, such as in the previous code listing, the operation will not block.
However, it will not return until all the data has been received from the server. In the case of a JSON array that would be the whole array.
However, if you are interested in just the first element of the array, <code>jsonStream</code> provides a better alternative since it starts streaming data from the server without needing the whole response.
For example, <code>jsonStream().firstElement()</code> will only parse the first item in a JSON array. Hence it is more efficient.
</td>
</tr>
</table>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/bintray.html">&lt;&lt; <strong>3</strong><span>Bintray API</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/declarativeclient.html"><strong>5</strong><span>Declarative Client</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>

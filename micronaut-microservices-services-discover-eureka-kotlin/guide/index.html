<!DOCTYPE html>
<html>
<head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='../img/micronaut-favicon.ico' />
    <meta charset='UTF-8' />
    <title>Eureka and Micronaut - Microservices service discovery | Micronaut Guides | Micronaut Framework</title>
    <meta name='description' content='Eureka and Micronaut - Microservices service discovery. Use Netflix Eureka service discovery to expose your Micronaut apps.' />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
</head>
<body class='guide'>
<div id="navigation">
    <div class="navTitle">
        <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <a href="http://guides.micronaut.io">Micronaut Guides</a>
                <span> &rarr; </span>
                <a href="http://guides.micronaut.io/micronaut-microservices-services-discover-eureka-kotlin/guide/index.html">Eureka and Micronaut - Microservices service discovery</a>
            </li>
        </ul>

    </div>
</div>

<div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin"><img src="https://travis-ci.org/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#solution"><strong>1.2</strong><span>Solution</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>2</strong><span>Writing the App</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookcatalogue"><strong>2.1</strong><span>Catalogue Microservice</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookinventory"><strong>2.2</strong><span>Inventory Microservice</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookrecommendation"><strong>2.3</strong><span>Recommendation Microservice</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>3</strong><span>Running the app</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#eureka"><strong>4</strong><span>Eureka and Micronaut</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#eurekaserver"><strong>4.1</strong><span>Eureka Server</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#micronautandeureka"><strong>4.2</strong><span>Integrate Eureka</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookcatalogueChanges"><strong>4.3</strong><span>Book Catalogue</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookinventoryChanges"><strong>4.4</strong><span>Book Inventory</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bookrecommendationChanges"><strong>4.5</strong><span>Book Recommendation</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#runningTheAppAfterEureka"><strong>4.6</strong><span>Running the App</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#nextSteps"><strong>5</strong><span>Next Steps</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Eureka and Micronaut - Microservices service discovery</h1>
        <p>Use Netflix Eureka service discovery to expose your Micronaut apps.</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Micronaut Version:</strong> 1.1.0</p>
    </header>
    

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, we are going to create three microservices and register them with <a href="https://github.com/Netflix/eureka">Netflix Eureka</a> service discovery.
You will discover how Micronaut eases Eureka integration.</p>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="solution">1.2 Solution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/solution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We recommend you to follow the instructions in the next sections and create the app step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository: <code>git clone <a href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.git" class="bare">https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, <code>cd</code> into the <code>complete</code> folder which you will find in the root project of the downloaded/cloned project.</p>
</div>


<h1 id="writingTheApp">2 Writing the App</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Lets describe the microservices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bookcatalogue</code> - It returns a list of books. It uses a domain consisting of a book name and isbn.</p>
</li>
<li>
<p><code>bookinventory</code> - It exposes an endpoint to check whether a book has sufficient stock to fullfil an order.  I uses a domain consisting of a stock level and isbn.</p>
</li>
<li>
<p><code>bookrecommendation</code> - It consumes previous services and exposes and endpoint which recommends book names which are in stock.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Initially we are going to hardcode the addresses where the different services are in the <code>bookcatalogue</code> service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/hardcoded.svg" alt="hardcoded">
</div>
</div>
<div class="paragraph">
<p>As shown in the previous image, the <code>bookcatalogue</code> hardcodes references to its collaborators.</p>
</div>
<div class="paragraph">
<p>In the second part of this tutorial we are going to use a discovery service.</p>
</div>
<div class="paragraph">
<p>The services register when they start up:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/discovery-service-registration.svg" alt="discovery service registration">
</div>
</div>
<div class="paragraph">
<p>When a service wants to do a request to other service, it uses the discovery service to retrieve the address.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/discovery-service-flow.svg" alt="discovery service flow">
</div>
</div>
<div class="paragraph">
<p>If you are using Java or Kotlin and IntelliJ IDEA make sure you have enabled annotation processing.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/annotationprocessorsintellij.png" alt="annotationprocessorsintellij">
</div>
</div>


<h2 id="bookcatalogue">2.1 Catalogue Microservice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/writingTheApp/bookcatalogue.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the <code>bookcatalogue</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookcatalogue.bookcatalogue</code></p>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookcatalogue</code> and a Micronaut app inside it with
default package: <code>example.micronaut.bookcatalogue</code>.</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/kotlin/example/micronaut/bookcatalogue/BooksController.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookcatalogue

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/books") <i class="conum" data-value="1"></i><b>(1)</b>
class BooksController {

    @Get("/") <i class="conum" data-value="2"></i><b>(2)</b>
    internal fun index(): List&lt;Book&gt; {
        return listOf(Book("1491950358", "Building Microservices"),
                Book("1680502395", "Release It!"),
                Book("0321601912", "Continuous Delivery:"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="http://docs.micronaut.io/snapshot/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/books</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Get</code> annotation is used to map the index method to <code>/books</code> requests that use an HTTP GET.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous controller responds a <code>Flowable&lt;Book&gt;</code>. Create the <code>Book</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/kotlin/example/micronaut/bookcatalogue/Book.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookcatalogue

data class Book(var isbn: String, val name: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write a test:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/test/kotlin/example/micronaut/bookcatalogue/BooksControllerSpec.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookcatalogue

import io.micronaut.context.ApplicationContext
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.runtime.server.EmbeddedServer
import org.spekframework.spek2.Spek
import org.spekframework.spek2.style.specification.describe
import kotlin.test.assertEquals
import kotlin.test.assertTrue

object BooksControllerSpec: Spek({
    describe("BookController Suite") {
        var embeddedServer : EmbeddedServer = ApplicationContext.run(EmbeddedServer::class.java)
        var client : HttpClient  = HttpClient.create(embeddedServer.url)

        it("books can be retrieved") {
            val req = HttpRequest.GET&lt;Any&gt;("/books") <i class="conum" data-value="1"></i><b>(1)</b>
            val books = client.toBlocking().retrieve(req, Argument.of(List::class.java, Book::class.java)) <i class="conum" data-value="2"></i><b>(2)</b>
            assertEquals(expected = books.size, actual = 3)
            assertTrue(books.contains(Book("1491950358", "Building Microservices")))
            assertTrue(books.contains(Book("1680502395", "Release It!")))
        }

        afterGroup {
            client.close()
            embeddedServer.close()
        }
    }

})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is easy to create HTTP requests with a fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Parse easily JSON into Java objects.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Edit <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    application:
        name: bookcatalogue <i class="conum" data-value="1"></i><b>(1)</b>
    server:
        port: 8081 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the application name. The app name will be use by the discovery service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the app to listen at port 8081</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a file named <code>application-test.yml</code> which is used in the test environment:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    server:
        port: -1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the micronaut microservice at a random port when running the tests.</td>
</tr>
</table>
</div>


<h2 id="bookinventory">2.2 Inventory Microservice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/writingTheApp/bookinventory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the <code>bookinventory</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookinventory.bookinventory</code></p>
</div>
<div class="paragraph">
<p>Modify <code>build.gradle</code> to add validation capabilities.</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">    compile "io.micronaut:micronaut-validation"
    compile "io.micronaut.configuration:micronaut-hibernate-validator"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookinventory</code> and a Micronaut app inside it with
default package: <code>example.micronaut.bookinventory</code>.</p>
</div>
<div class="paragraph">
<p>Create a Controller:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/kotlin/example/micronaut/bookinventory/BooksController.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookinventory

import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces
import io.micronaut.validation.Validated
import javax.validation.constraints.NotBlank
import java.util.Optional

@Validated <i class="conum" data-value="1"></i><b>(1)</b>
@Controller("/books") <i class="conum" data-value="2"></i><b>(2)</b>
open class BooksController {

    @Produces(MediaType.TEXT_PLAIN) <i class="conum" data-value="3"></i><b>(3)</b>
    @Get("/stock/{isbn}") <i class="conum" data-value="4"></i><b>(4)</b>
    open fun stock(@NotBlank isbn: String): Boolean? {
        return bookInventoryByIsbn(isbn).map { (_, stock) -&gt; stock &gt; 0 }.orElse(null)
    }

    private fun bookInventoryByIsbn(isbn: String): Optional&lt;BookInventory&gt; {
        if (isbn == "1491950358") {
            return Optional.of(BookInventory(isbn, 4))

        } else if (isbn == "1680502395") {
            return Optional.of(BookInventory(isbn, 0))
        }
        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define <a href="https://docs.micronaut.io/snapshot/api/io/micronaut/validation/Validated.html">Validated</a> annotation at the class level to signal any class that requires validation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class is defined as a controller with the <a href="http://docs.micronaut.io/snapshot/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/books</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By default a Micronaut&#8217;s response uses <code>application/json</code> as <code>Content-Type</code>. We are returning a String not a JSON object. Because of that, we set it to <code>text/plain</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@Get</code> annotation is used to map the index method to <code>/books/stock/{isbn}</code> requests that use an HTTP GET.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous controller uses a POJO:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/kotlin/example/micronaut/bookinventory/BookInventory.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookinventory

data class BookInventory(var isbn: String, val stock: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write a test:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/test/kotlin/example/micronaut/bookinventory/BooksControllerSpec.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookinventory

import io.micronaut.context.ApplicationContext
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpStatus
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.exceptions.HttpClientException
import io.micronaut.runtime.server.EmbeddedServer
import org.spekframework.spek2.Spek
import org.spekframework.spek2.style.specification.describe
import kotlin.test.assertEquals
import kotlin.test.assertFailsWith
import kotlin.test.assertFalse
import kotlin.test.assertTrue

object BookControllerSpec: Spek({
    describe("BookController Suite") {
        var embeddedServer : EmbeddedServer = ApplicationContext.run(EmbeddedServer::class.java)
        var client : HttpClient  = HttpClient.create(embeddedServer.url)

        it("a book in stock returns true") {
            val req = HttpRequest.GET&lt;Any&gt;("/books/stock/1491950358")
            val hasStock = client.toBlocking().retrieve(req, Boolean::class.java)
            assertTrue(hasStock)
        }
        it("a book out of stock returns false") {
            val req = HttpRequest.GET&lt;Any&gt;("/books/stock/1680502395")
            val hasStock = client.toBlocking().retrieve(req, Boolean::class.java)
            assertFalse(hasStock)
        }

        it("non existing Isbn returns 404") {
            val ex = assertFailsWith&lt;HttpClientException&gt; {
                val req = HttpRequest.GET&lt;Any&gt;("/books/stock/XXXXX")
                val hasStock = client.toBlocking().retrieve(req, Boolean::class.java)
            }
            assertEquals(ex.message, "Page Not Found")
        }

        afterGroup {
            client.close()
            embeddedServer.close()
        }
    }

})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    application:
        name: bookinventory <i class="conum" data-value="1"></i><b>(1)</b>
    server:
        port: 8082 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the application name. The app name will be used later in the tutorial.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the app to listen at port 8082</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a file named <code>application-test.yml</code> which is used in the test environment:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    server:
        port: -1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the micronaut microservice at a random port when running the tests.</td>
</tr>
</table>
</div>


<h2 id="bookrecommendation">2.3 Recommendation Microservice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/writingTheApp/bookrecommendation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the <code>bookrecommendation</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookrecommendation.bookrecommendation</code></p>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookrecommendation</code> and a Micronaut app inside it with
default package: <code>example.micronaut.bookrecommendation</code>.</p>
</div>
<div class="paragraph">
<p>Create an interface to map operations with <code>bookcatalogue</code> and a Micronaut Declarative HTTP Client to consume it.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookCatalogueOperations.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.reactivex.Flowable

interface BookCatalogueOperations {
    fun findAll(): Flowable&lt;Book&gt;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookCatalogueClient.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable


@Client("http://localhost:8081") <i class="conum" data-value="1"></i><b>(1)</b>
interface BookCatalogueClient : BookCatalogueOperations {

    @Get("/books")
    override fun findAll(): Flowable&lt;Book&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>@Client</code> to use <a href="https://docs.micronaut.io/snapshot/guide/index.html#clientAnnotation">declarative HTTP Clients</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The client returns a POJO. Create it in the <code>bookrecommendation</code>:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/Book.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

data class Book(var isbn: String, val name: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an interface to map operations with <code>bookinventory</code> and a Micronaut Declarative HTTP Client to consume it.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookInventoryOperations.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.reactivex.Maybe

import javax.validation.constraints.NotBlank

interface BookInventoryOperations {
    fun stock(@NotBlank isbn: String): Maybe&lt;Boolean&gt;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookInventoryClient.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import javax.validation.constraints.NotBlank


@Client("http://localhost:8082") <i class="conum" data-value="1"></i><b>(1)</b>
interface BookInventoryClient : BookInventoryOperations {

    @Get("/books/stock/{isbn}")
    override fun stock(@NotBlank isbn: String): Maybe&lt;Boolean&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>@Client</code> to use <a href="https://docs.micronaut.io/snapshot/guide/index.html#clientAnnotation">declarative HTTP Clients</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a Controller which injects both clients.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BooksController.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable

@Controller("/books") <i class="conum" data-value="1"></i><b>(1)</b>
class BooksController(private val bookCatalogueOperations: BookCatalogueOperations,
                     private val bookInventoryOperations: BookInventoryOperations) { <i class="conum" data-value="2"></i><b>(2)</b>

    @Get("/") <i class="conum" data-value="3"></i><b>(3)</b>
    fun index(): Flowable&lt;BookRecommendation&gt; {
        return bookCatalogueOperations.findAll()
                .flatMapMaybe { b -&gt;
                    bookInventoryOperations.stock(b.isbn)
                            .filter { hasStock -&gt; hasStock }
                            .map { _ -&gt; b }
                }.map { (_, name) -&gt; BookRecommendation(name) }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="http://docs.micronaut.io/snapshot/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/books</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Get</code> annotation is used to map the index method to <code>/books</code> requests that use an HTTP GET.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous controller returns a <code>Flowable&lt;BookRecommendation&gt;</code>. Create the <code>BookRecommendation</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookRecommendation.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

data class BookRecommendation(val name: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>BookCatalogueClient</code> and <code>BookInventoryClient</code> will fail to consume the <code>bookcatalogue</code> and <code>bookinventory</code> during the tests phase.</p>
</div>
<div class="paragraph">
<p>Using the <a href="https://docs.micronaut.io/snapshot/guide/index.html#clientFallback">@Fallback</a> annotation you can declare a fallback implementation of a client that will be picked up and used once all possible retries have been exhausted</p>
</div>
<div class="paragraph">
<p>Create <code>@Fallback</code> alternatives in the <code>test</code> classpath.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/test/kotlin/example/micronaut/bookrecommendation/BookInventoryClientStub.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.retry.annotation.Fallback
import io.reactivex.Maybe
import javax.inject.Singleton
import javax.validation.constraints.NotBlank

@Requires(env = arrayOf(Environment.TEST))
@Fallback
@Singleton
class BookInventoryClientStub : BookInventoryOperations {

    override fun stock(@NotBlank isbn: String): Maybe&lt;Boolean&gt; {
        if (isbn == "1491950358") {
            return Maybe.just(java.lang.Boolean.TRUE)

        } else if (isbn == "1680502395") {
            return Maybe.just(java.lang.Boolean.FALSE)
        }
        return Maybe.empty()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/test/kotlin/example/micronaut/bookrecommendation/BookCatalogueClientStub.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.retry.annotation.Fallback
import io.reactivex.Flowable

import javax.inject.Singleton

@Requires(env = arrayOf(Environment.TEST))
@Fallback
@Singleton
class BookCatalogueClientStub : BookCatalogueOperations {

    override fun findAll(): Flowable&lt;Book&gt; {
        val buildingMicroservices = Book("1491950358", "Building Microservices")
        val releaseIt = Book("1680502395", "Release It!")
        return Flowable.just(buildingMicroservices, releaseIt)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write a test:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/test/kotlin/example/micronaut/bookrecommendation/BookControllerSpec.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.context.ApplicationContext
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.RxStreamingHttpClient
import io.micronaut.runtime.server.EmbeddedServer
import org.spekframework.spek2.Spek
import org.spekframework.spek2.style.specification.describe
import kotlin.test.assertEquals

object BookControllerSpec: Spek({
    describe("BookController Suite") {
        var embeddedServer : EmbeddedServer = ApplicationContext.run(EmbeddedServer::class.java)
        var client : RxStreamingHttpClient  = embeddedServer.applicationContext.createBean(RxStreamingHttpClient::class.java, embeddedServer.url)

        it("books can be retrieved") {
            val req = HttpRequest.GET&lt;Any&gt;("/books")
            val books = client.jsonStream(req, BookRecommendation::class.java)
            assertEquals(books.toList().blockingGet().size, 1)
            assertEquals(books.toList().blockingGet()[0].name, "Building Microservices")
        }

        afterGroup {
            client.close()
            embeddedServer.close()
        }
    }

})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    application:
        name: bookrecommendation <i class="conum" data-value="1"></i><b>(1)</b>
    server:
        port: 8080 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the application name. The app name will be used later in the tutorial.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the app to listen at port 8080</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a file named <code>application-test.yml</code> which is used in the test environment:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">micronaut:
    server:
        port: -1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the micronaut microservice at a random port when running the tests.</td>
</tr>
</table>
</div>


<h1 id="runningTheApp">3 Running the app</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Run <code>bookcatalogue</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookcatalogue $ ./gradlew run
 ...
 &gt; Task :bookcatalogue:run
 14:28:34.034 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 499ms. Server Running: http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookinventory</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookinventory $ ./gradlew run
 ...
 &gt; Task :bookcatalogue:run
 14:31:13.104 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 499ms. Server Running: http://localhost:8082</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookrecommendation</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookrecommendation $ ./gradlew run
...
&gt; Task :bookrecommendation:run
14:31:57.389 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 523ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run a cURL command to test the whole application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080/books
[{"name":"Building Microservices"}</code></pre>
</div>
</div>


<h1 id="eureka">4 Eureka and Micronaut</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka">Netflix Eureka</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Eureka is a REST (Representational State Transfer) based service that is primarily used in the AWS cloud for locating services for the purpose of load balancing and failover of middle-tier servers.</p>
</div>
</blockquote>
</div>


<h2 id="eurekaserver">4.1 Eureka Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/eurekaserver.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://cloud.spring.io/spring-cloud-netflix/">Spring-Cloud-Netflix</a> provides a very neat way to bootstrap Eureka.
To bring up Eureka server using Spring-Cloud-Netflix:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://github.com/spring-cloud-samples/eureka">sample Eureka server application</a>.</p>
</li>
<li>
<p>Run this project as a Spring Boot app (e.g. import into IDE and run
main method, or use <code>mvn spring-boot:run</code> or <code>gradle bootRun</code> or <code>./gradlew bootRun</code>). It will start up on port
8761 and serve the Eureka API from <code>/eureka</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This <a href="#solution">tutorial solution</a> contains a folder named <code>eureka</code> with the cloned sample Eureka server application.</p>
</div>


<h2 id="micronautandeureka">4.2 Integrate Eureka</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/micronautandeureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="bookcatalogueChanges">4.3 Book Catalogue</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/bookcatalogueChanges.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>build.gradle</code> to add <code>discovery-client</code> dependency.</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    ...
    ..
    .
    runtime "io.micronaut:micronaut-discovery-client"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Append to <code>bookcatalogue</code> service <code>application.yml</code> the following snippet:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
  client:
    registration:
      enabled: true
    defaultZone: "${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Previous configuration registers a Micronaut app with Eureka with minimal configuration. Discover a more complete list of Configuration options at <a href="https://docs.micronaut.io/snapshot/api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>Disable Eureka registration in tests:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
    client:
        registration:
            enabled: false</code></pre>
</div>
</div>


<h2 id="bookinventoryChanges">4.4 Book Inventory</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/bookinventoryChanges.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>build.gradle</code> to add <code>discovery-client</code> dependency.</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    ...
    ..
    .
    runtime "io.micronaut:micronaut-discovery-client"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, append to <code>bookinventory</code>.<code>application.yml</code> the following snippet:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
  client:
    registration:
      enabled: true
    defaultZone: "${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disable Eureka registration in tests:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
    client:
        registration:
            enabled: false</code></pre>
</div>
</div>


<h2 id="bookrecommendationChanges">4.5 Book Recommendation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/bookrecommendationChanges.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>build.gradle</code> to add <code>discovery-client</code> dependency.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    ...
    ..
    .
    runtime "io.micronaut:micronaut-discovery-client"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, append to <code>bookrecommendation</code>.<code>application.yml</code> the following snippet:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
  client:
    registration:
      enabled: true
    defaultZone: "${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>BookInventoryClient</code> and <code>BookCatalogueClient</code> to use the service id instead of a harcoded ip.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookCatalogueClient.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable


@Client(id = "bookcatalogue") <i class="conum" data-value="1"></i><b>(1)</b>
interface BookCatalogueClient : BookCatalogueOperations {

    @Get("/books")
    override fun findAll(): Flowable&lt;Book&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the configuration value <code>micronaut.application.name</code> used in <code>bookcatalogue</code> as service <code>id</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/kotlin/example/micronaut/bookrecommendation/BookInventoryClient.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin" data-lang="kotlin">package example.micronaut.bookrecommendation

import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import javax.validation.constraints.NotBlank


@Client(id = "bookinventory") <i class="conum" data-value="1"></i><b>(1)</b>
interface BookInventoryClient : BookInventoryOperations {

    @Get("/books/stock/{isbn}")
    override fun stock(@NotBlank isbn: String): Maybe&lt;Boolean&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the configuration value <code>micronaut.application.name</code> used in <code>bookinventory</code> as service <code>id</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Disable Eureka registration in tests:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/resources/application-test.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">eureka:
    client:
        registration:
            enabled: false</code></pre>
</div>
</div>


<h2 id="runningTheAppAfterEureka">4.6 Running the App</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/eureka/runningTheAppAfterEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Run the eureka server:</p>
</div>
<div class="paragraph">
<p><code>eureka $ ./gradle bootRun</code></p>
</div>
<div class="paragraph">
<p>Run <code>bookcatalogue</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookcatalogue $ ./gradlew run
 ...

 &gt; Task :bookcatalogue:run
 14:28:34.034 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 499ms. Server Running: http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookinventory</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookinventory $ ./gradlew run
 ...
 &gt; Task :bookcatalogue:run
 14:31:13.104 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 499ms. Server Running: http://localhost:8082</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookrecommendation</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">bookrecommendation $ ./gradlew run
...
&gt; Task :bookrecommendation:run
14:31:57.389 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 523ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <a href="http://localhost:8761">http://localhost:8761</a> in your browser.</p>
</div>
<div class="paragraph">
<p>You will see the services registered in Eureka:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/eurekaui.png" alt="eurekaui">
</div>
</div>
<div class="paragraph">
<p>You can run a cURL command to test the whole application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080/books
[{"name":"Building Microservices"}</code></pre>
</div>
</div>


<h1 id="nextSteps">5 Next Steps</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-microservices-services-discover-eureka-kotlin/edit/master/src/main/docs/guide/nextSteps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Read more about <a href="https://docs.micronaut.io/snapshot/guide/index.html#serviceDiscoveryEureka">Eureka Support</a> inside Micronaut.</p>
</div>

</article>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115754405-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-115754405-1');
</script>
</body>
</html>

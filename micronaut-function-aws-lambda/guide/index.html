<!DOCTYPE html>
<html>
<head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='../img/micronaut-favicon.ico' />
    <meta charset='UTF-8' />
    <title>Micronaut Functions deployed in AWS Lambda | Micronaut Guides | Micronaut Framework</title>
    <meta name='description' content='Micronaut Functions deployed in AWS Lambda. Learn how to write a function with Micronaut and deploy it to AWS Lambda.' />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
</head>
<body class='guide'>
<div id="navigation">
    <div class="navTitle">
        <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <a href="http://guides.micronaut.io">Micronaut Guides</a>
                <span> &rarr; </span>
                <a href="http://guides.micronaut.io/micronaut-function-aws-lambda/guide/index.html">Micronaut Functions deployed in AWS Lambda</a>
            </li>
        </ul>

    </div>
</div>

<div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/micronaut-guides/micronaut-function-aws-lambda"><img src="https://travis-ci.org/micronaut-guides/micronaut-function-aws-lambda.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-function-aws-lambda&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:micronaut-guides/micronaut-function-aws-lambda.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/micronaut-guides/micronaut-function-aws-lambda.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:micronaut-guides/micronaut-function-aws-lambda.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-function-aws-lambda/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#solution"><strong>1.2</strong><span>Solution</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheLambda"><strong>2</strong><span>Writing the Function</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#functionpojos"><strong>2.1</strong><span>POJOs</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#soap"><strong>2.2</strong><span>SOAP VAT Validation</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#function"><strong>2.3</strong><span>Function</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#functiontests"><strong>2.4</strong><span>Function Tests</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#sam"><strong>3</strong><span>Test with SAM CLI</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#awslambda"><strong>4</strong><span>Deploy to AWS Lambda</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>5</strong><span>Writing the App</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#pojos"><strong>5.1</strong><span>POJOs</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#functionclient"><strong>5.2</strong><span>Call the Function</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#controller"><strong>5.3</strong><span>Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#tests"><strong>5.4</strong><span>Tests</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>6</strong><span>Running the app</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#awsApiGateway"><strong>7</strong><span>AWS API Gateway</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#awsApiGatewayUrlInMicronaut"><strong>7.1</strong><span>Consume API Gateway URL</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#graal"><strong>8</strong><span>Running the Function on Graal Native Image</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#nextSteps"><strong>9</strong><span>Next Steps</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#help"><strong>10</strong><span>Help with Micronaut</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Micronaut Functions deployed in AWS Lambda</h1>
        <p>Learn how to write a function with Micronaut and deploy it to AWS Lambda.</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Micronaut Version:</strong> 1.2.10</p>
    </header>
    

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Lets describe the microservices you are going to build through the tutorial.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vies-vat-validator</code> - A Function which you will build with Micronaut and deploy to <a href="https://aws.amazon.com/lambda/">AWS Lambda</a>.</p>
</li>
<li>
<p><code>invoice</code> - A microservice which  exposes an endpoint to check the Value Added Tax (VAT) which should apply to an invoice. It consumes the <code>vies-vat-validator</code> function to ensure the VAT number is valid.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next diagram illustrates the flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/microservices-and-lambda.svg" alt="microservices and lambda">
</div>
</div>
<div class="paragraph">
<p>If you are using Java or Kotlin and IntelliJ IDEA make sure you have enabled annotation processing.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/annotationprocessorsintellij.png" alt="annotationprocessorsintellij">
</div>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will need also an <a href="https://aws.amazon.com/account/">AWS Account</a>.</p>
</div>


<h2 id="solution">1.2 Solution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/solution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We recommend you to follow the instructions in the next sections and create the app step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository: <code>git clone <a href="https://github.com/micronaut-guides/micronaut-function-aws-lambda.git" class="bare">https://github.com/micronaut-guides/micronaut-function-aws-lambda.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, <code>cd</code> into the <code>complete</code> folder which you will find in the root project of the downloaded/cloned project.</p>
</div>


<h1 id="writingTheLambda">2 Writing the Function</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheLambda.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the function:</p>
</div>
<div class="paragraph">
<p><code>mn create-function example.micronaut.vies-vat-validator</code></p>
</div>


<h2 id="functionpojos">2.1 POJOs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheLambda/functionpojos.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a POJO to encapsulate the validation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
  "memberStateCode": "es",
  "vatNumber": "B86412491"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/main/java/example/micronaut/VatValidationRequest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidationRequest implements Serializable {
    private String memberStateCode;
    private String vatNumber;

    public VatValidationRequest() {
    }

    public VatValidationRequest(String memberStateCode, String vatNumber) {
        this.memberStateCode = memberStateCode;
        this.vatNumber = vatNumber;
    }

    public String getMemberStateCode() {
        return memberStateCode;
    }

    public void setMemberStateCode(String memberStateCode) {
        this.memberStateCode = memberStateCode;
    }

    public String getVatNumber() {
        return vatNumber;
    }

    public void setVatNumber(String vatNumber) {
        this.vatNumber = vatNumber;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And another POJO to encapsulate the expected response. Note: we add a <code>Boolean valid</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
  "memberStateCode": "es",
  "vatNumber": "B86412491"
  "valid": true
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/main/java/example/micronaut/VatValidation.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidation extends VatValidationRequest implements Serializable {
    private Boolean valid;

    public VatValidation() {

    }

    public VatValidation(String memberStateCode, String vatNumber, Boolean valid) {
        super(memberStateCode, vatNumber);
        this.valid = valid;
    }

    public Boolean getValid() {
        return valid;
    }

    public void setValid(Boolean valid) {
        this.valid = valid;
    }

    public Boolean isValid() {
        return valid;
    }
}</code></pre>
</div>
</div>


<h2 id="soap">2.2 SOAP VAT Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheLambda/soap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>VIES (<a href="http://ec.europa.eu/taxation_customs/vies/faq.html">VAT Information Exchange System</a>) is an electronic mean of validating VAT-identification numbers of economic operators registered in the European Union for cross border transactions on goods or services.</p>
</div>
<div class="paragraph">
<p>For example, if you create an e-commerce Web application in the European union you would need to check the validity of the purchaser&#8217;s
VAT Number in order to create a proper invoice.</p>
</div>
<div class="paragraph">
<p>To automate the validation checks, the EU does not offer a REST endpoint but a SOAP service. Its WSDL file can be obtained <a href="http://ec.europa.eu/taxation_customs/vies/checkVatService.wsdl">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>SOAP</strong> (originally Simple Object Access Protocol) is a protocol specification for exchanging structured information in the implementation of web services in computer networks. Its purpose is to induce extensibility, neutrality and independence</p>
</div>
<div class="paragraph">
<p>Create <code>VatService</code> to do a SOAP request to validate the VAT Number.</p>
</div>
<div class="paragraph">
<p>To consume the SOAP service we could have use a SOAP library. However, the use case is so simple we are going to use the Micronaut HTTP Client and build
the SOAP envelope manually.</p>
</div>
<div class="paragraph">
<p>Add <code>http-client</code> dependency to <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-http-client"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>VatService</code> which consumes the SOAP Service:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/main/java/example/micronaut/VatService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Flowable;
import io.reactivex.Single;

import javax.inject.Singleton;

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
public class VatService {
    private static final String SERVER = "http://ec.europa.eu";
    private static final String PATH = "/taxation_customs/vies/services/checkVatService";
    private static final String VALID_XML_OPEN_TAG = "&lt;valid&gt;";
    private static final String VALID_XML_CLOSE_TAG = "&lt;/valid&gt;";

    protected final RxHttpClient client;

    public VatService(@Client("http://ec.europa.eu") RxHttpClient client) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.client = client;
    }

    public Single&lt;Boolean&gt; validateVat(String memberStateCode, String vatNumber) {
        String soapEnvelope = soapEnvelope(memberStateCode, vatNumber);
        HttpRequest request = HttpRequest.POST(SERVER+PATH, soapEnvelope)  <i class="conum" data-value="3"></i><b>(3)</b>
                .contentType("application/soap+xml");

        Flowable&lt;String&gt; response = client.retrieve(request, String.class);
        return response.firstOrError().map(this::parseResponseToBoolean);
    }

    private Boolean parseResponseToBoolean(String response) {
        if (!response.contains(VALID_XML_OPEN_TAG) || !response.contains(VALID_XML_CLOSE_TAG)) {
            return false;
        }
        int beginIndex = response.indexOf(VALID_XML_OPEN_TAG) + VALID_XML_OPEN_TAG.length();
        String validResponse = response.substring(beginIndex, response.indexOf(VALID_XML_CLOSE_TAG));
        return Boolean.valueOf(validResponse);
    }

    private String soapEnvelope(String memberStateCode, String vatNumber) {
        StringBuilder sb = new StringBuilder();
        sb.append("&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;");
        sb.append("&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;");
        sb.append("&lt;soapenv:Header/&gt;");
        sb.append("&lt;soapenv:Body xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;");
        sb.append("&lt;urn:checkVat xmlns:urn=\"urn:ec.europa.eu:taxud:vies:services:checkVat:types\"&gt;");
        sb.append("&lt;urn:countryCode&gt;");
        sb.append(memberStateCode);
        sb.append("&lt;/urn:countryCode&gt;");
        sb.append("&lt;urn:vatNumber&gt;");
        sb.append(vatNumber);
        sb.append("&lt;/urn:vatNumber&gt;");
        sb.append("&lt;/urn:checkVat&gt;");
        sb.append("&lt;/soapenv:Body&gt;");
        sb.append("&lt;/soapenv:Envelope&gt;");
        return sb.toString();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>javax.inject.Singleton</code> to designate a class a a singleton</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor Injection of Micronaut RxClient</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define a POST Request.</td>
</tr>
</table>
</div>


<h2 id="function">2.3 Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheLambda/function.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Edit <code>ViesVatValidatorFunction</code></p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/main/java/example/micronaut/ViesVatValidatorFunction.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.function.FunctionBean;
import io.reactivex.Flowable;
import io.reactivex.Single;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.concurrent.ExecutionException;
import java.util.function.Function;

@FunctionBean("vies-vat-validator") <i class="conum" data-value="1"></i><b>(1)</b>
public class ViesVatValidatorFunction
        implements Function&lt;VatValidationRequest, VatValidation&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
    private static final Logger LOG = LoggerFactory.getLogger(ViesVatValidatorFunction.class); <i class="conum" data-value="3"></i><b>(3)</b>

    private final VatService vatService;

    public ViesVatValidatorFunction(VatService vatService) { <i class="conum" data-value="4"></i><b>(4)</b>
        this.vatService = vatService;
    }

    @Override
    public VatValidation apply(VatValidationRequest request) {
        final String memberStateCode = request.getMemberStateCode();
        final String vatNumber = request.getVatNumber();
        if (LOG.isDebugEnabled()) {
            LOG.debug("validate country: {} vat number: {}", memberStateCode, vatNumber);
        }
        return vatService.validateVat(memberStateCode, vatNumber)
                    .map(valid -&gt; new VatValidation(memberStateCode, vatNumber, valid))
                    .blockingGet(); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@FunctionBean</code>. <code>vies-vat-validator</code> is an optional ID of the function which may or may not be used depending on the target platform.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We implement <code>java.util.function.Function</code>. That it is the easiest way to have a parameter with an incoming JSON Payload
and JSON Payload response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure a logger for the function. If you use AWS Lambda, you will be able to see this logs in CloudWatch Logs.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Inject via constructor <code>VatService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We cannot return a non-blocking type due to AWS Lambda <a href="https://docs.aws.amazon.com/lambda/latest/dg/java-programming-model-req-resp.html">Handler Input/Output supported Types</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Modify <code>logback.xml</code> to set <code>DEBUG</code> level for package <code>example.micronaut</code>.</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/main/resources/logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">&lt;configuration&gt;

    &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;
        &lt;withJansi&gt;true&lt;/withJansi&gt;
        &lt;!-- encoders are assigned the type
             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%cyan(%d{HH:mm:ss.SSS}) %gray([%thread]) %highlight(%-5level) %magenta(%logger{36}) - %msg%n
            &lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;root level="info"&gt;
        &lt;appender-ref ref="STDOUT"/&gt;
    &lt;/root&gt;
    &lt;logger name="example.micronaut" level="DEBUG"/&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>


<h2 id="functiontests">2.4 Function Tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheLambda/functiontests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><code>build.gradle</code> already contains these dependencies:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">testRuntime "io.micronaut:micronaut-http-server-netty"
testRuntime "io.micronaut:micronaut-function-web"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because of that, testing your functions is really easy.</p>
</div>
<div class="paragraph">
<p>First modify <code>ViesVatValidatorClient</code> interface to match to the method signature forced by <code>Function&lt;VatValidationRequest, VatValidation&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/test/java/example/micronaut/ViesVatValidatorClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.function.client.FunctionClient;
import io.micronaut.http.annotation.Body;
import io.reactivex.Flowable;
import io.reactivex.Single;

import javax.inject.Named;

@FunctionClient
public interface ViesVatValidatorClient {

    @Named("vies-vat-validator")
    Single&lt;VatValidation&gt; apply(@Body VatValidationRequest request);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can start up the Micronaut application and access your function via the client interface in your test.</p>
</div>
<div class="paragraph">
<p>Modify <code>ViesVatValidatorFunctionTest.java</code>:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/src/test/java/example/micronaut/ViesVatValidatorFunctionTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
public class ViesVatValidatorFunctionTest {

    @Inject
    ViesVatValidatorClient client; <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    public void testViesVatValidatorFunction() throws Exception {
        VatValidationRequest req = new VatValidationRequest("es", "B99286353");
        assertTrue(client.apply(req).blockingGet().isValid());

        req = new VatValidationRequest("es", "B19280031");
        assertTrue(client.apply(req).blockingGet().isValid());

        req = new VatValidationRequest("es", "XXXXXXXXX");
        assertFalse(client.apply(req).blockingGet().isValid());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> to let Micronaut starts the embedded server and inject the beans. More info: <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>ViesVatValidatorClient</code> bean in the application context.</td>
</tr>
</table>
</div>


<h1 id="sam">3 Test with SAM CLI</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/sam.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/awslabs/aws-sam-cli">AWS SAM CLI</a> is a CLI tool for local development and testing of Serverless applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can skip this section. If you want to complete this section you will need SAM and Docker installed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test your Micronuat function with SAM you will first need to <a href="https://github.com/awslabs/aws-sam-cli/blob/develop/docs/installation.rst">install SAM</a>.</p>
</div>
<div class="paragraph">
<p>Then create a file <code>event.json</code>. We will use it as the stimulus for the SAM cli invocation.</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/event.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
  "memberStateCode": "es",
  "vatNumber": "B86412491"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next create a <a href="https://github.com/awslabs/serverless-application-model">AWS SAM template</a> file:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator/template.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

# More info about Globals: https://github.com/awslabs/serverless-application-model/blob/master/docs/globals.rst
Globals:
  Function:
    Timeout: 25

Resources:

  ViesVatValidatorFunction:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: build/libs/complete/vies-vat-validator-0.1-all.jar
      Handler: io.micronaut.function.aws.MicronautRequestStreamHandler
      Runtime: java8</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that in place, you can invoke your function locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sam local invoke "ViesVatValidatorFunction" -e event.json
2018-08-25 08:29:05 Invoking io.micronaut.function.aws.MicronautRequestStreamHandler (java8)
2018-08-25 08:29:05 Found credentials in shared credentials file: ~/.aws/credentials
2018-08-25 08:29:05 Decompressing /Users/sdelamo/Developer/micronaut-guides/micronaut-function-aws-lambda/complete/vies-vat-validator/build/libs/complete/vies-vat-validator-0.1-all.jar

Fetching lambci/lambda:java8 Docker container image......
2018-08-25 08:29:09 Mounting /private/var/folders/pb/dx1ms2_92_g54v9jvzv7k4hc0000gn/T/tmpvxc4Vb as /var/task:ro inside runtime container
START RequestId: e32a669c-bb51-4079-a1a1-781c2f144e4e Version: $LATEST
06:29:14.143 [main] DEBUG e.micronaut.ViesVatValidatorFunction - validate country: es vat number: B86412491
END RequestId: e32a669c-bb51-4079-a1a1-781c2f144e4e
REPORT RequestId: e32a669c-bb51-4079-a1a1-781c2f144e4e	Duration: 5627.70 ms	Billed Duration: 5700 ms	Memory Size: 128 MB	Max Memory Used: 9 MB

{"memberStateCode":"es","vatNumber":"B86412491","valid":true}</code></pre>
</div>
</div>


<h1 id="awslambda">4 Deploy to AWS Lambda</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/awslambda.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Deploy your Micronaut function to <a href="https://aws.amazon.com/lambda/">AWS Lambda</a>.</p>
</div>
<div class="paragraph">
<p>First, create a Function. I select Paris as the region.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step1.png" alt="step1">
</div>
</div>
<div class="paragraph">
<p>Select Java 8 runtime. Name: <code>vies-vat-validator</code> and <code>create a new role form template(s)</code>. I give the role name
<code>lambda_basic_execution</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step2.png" alt="step2">
</div>
</div>
<div class="paragraph">
<p>Configure tests events:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step3.png" alt="step3">
</div>
</div>
<div class="paragraph">
<p>Create a payload with valid data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step4.png" alt="step4">
</div>
</div>
<div class="paragraph">
<p>Generate a jar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>`vies-vat-validator $ ./gradlew shadowJar`</pre>
</div>
</div>
<div class="paragraph">
<p>The file is just 12MB ;-)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ du -h build/libs/complete/vies-vat-validator-0.1-all.jar
 12M    build/libs/complete/vies-vat-validator-0.1-all.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upload the JAR as illustrated here:</p>
</div>
<div class="paragraph">
<p>Enter as <code>Handler</code> value <code>io.micronaut.function.aws.MicronautRequestStreamHandler</code>.</p>
</div>
<div class="paragraph">
<p>I have allocated just 256Mb and a timeout of 25s.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step5.png" alt="step5">
</div>
</div>


<h1 id="writingTheApp">5 Writing the App</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now, it is time to consume the AWS Lambda function from another micronaut Microservice:</p>
</div>
<div class="paragraph">
<p>Create the microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">mn create-app example.micronaut.invoice</code></pre>
</div>
</div>


<h2 id="pojos">5.1 POJOs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/pojos.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We expect to get an incoming JSON payload such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
"vatNumber": "B86412491",
"countryCode": "es",
"lines": [
    {
        "count": 2,
        "productId": "1491950358",
        "price": 19.99
    },
    {
        "count": 1,
        "productId": "1680502395",
        "price": 15
    },
]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create two POJOs to map it.</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/Invoice.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;
import java.util.List;
import java.util.Objects;

@Introspected
public class Invoice {

    @NotNull
    @NotBlank
    private String vatNumber;

    @NotNull
    @NotBlank
    private String countryCode;

    @NotEmpty
    private List&lt;InvoiceLine&gt; lines;

    public Invoice() {
    }

    public Invoice(@NotNull @NotBlank String vatNumber,
                   @NotNull @NotBlank String countryCode,
                   @NotEmpty List&lt;InvoiceLine&gt; lines) {
        this.vatNumber = vatNumber;
        this.countryCode = countryCode;
        this.lines = lines;
    }

    public String getVatNumber() {
        return vatNumber;
    }

    public void setVatNumber(String vatNumber) {
        this.vatNumber = vatNumber;
    }

    public String getCountryCode() {
        return countryCode;
    }

    public void setCountryCode(String countryCode) {
        this.countryCode = countryCode;
    }

    public List&lt;InvoiceLine&gt; getLines() {
        return lines;
    }

    public void setLines(List&lt;InvoiceLine&gt; lines) {
        this.lines = lines;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Invoice invoice = (Invoice) o;
        return Objects.equals(vatNumber, invoice.vatNumber) &amp;&amp;
                Objects.equals(countryCode, invoice.countryCode) &amp;&amp;
                Objects.equals(lines, invoice.lines);
    }

    @Override
    public int hashCode() {
        return Objects.hash(vatNumber, countryCode, lines);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/InvoiceLine.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Positive;
import java.math.BigDecimal;
import java.util.Objects;

@Introspected
public class InvoiceLine {
    @NotNull
    @NotBlank
    private String productId;

    @Positive
    private Integer count;

    @NotNull
    @Positive
    private BigDecimal price;

    public InvoiceLine() {
    }

    public InvoiceLine(String productId, Integer count, BigDecimal price) {
        this.productId = productId;
        this.count = count;
        this.price = price;
    }

    public BigDecimal vatPrice(BigDecimal vatPercentage) {
        return getPrice().multiply(BigDecimal.valueOf(getCount()).multiply(vatPercentage));
    }

    public String getProductId() {
        return productId;
    }

    public void setProductId(String productId) {
        this.productId = productId;
    }

    public Integer getCount() {
        return count;
    }

    public void setCount(Integer count) {
        this.count = count;
    }

    public BigDecimal getPrice() {
        return price;
    }

    public void setPrice(BigDecimal price) {
        this.price = price;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        InvoiceLine that = (InvoiceLine) o;
        return Objects.equals(productId, that.productId) &amp;&amp;
                Objects.equals(count, that.count) &amp;&amp;
                Objects.equals(price, that.price);
    }

    @Override
    public int hashCode() {
        return Objects.hash(productId, count, price);
    }
}</code></pre>
</div>
</div>


<h2 id="functionclient">5.2 Call the Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/functionclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create an interface to abstract the collaboration with the function:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidator.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.annotation.Body;
import io.reactivex.Single;

public interface VatValidator {

    Single&lt;VatValidation&gt; validateVat(@Body VatValidationRequest req);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create two POJOs which are used by the previous interface:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidationRequest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidationRequest implements Serializable {
    private String memberStateCode;
    private String vatNumber;

    public VatValidationRequest() {
    }

    public VatValidationRequest(String memberStateCode, String vatNumber) {
        this.memberStateCode = memberStateCode;
        this.vatNumber = vatNumber;
    }

    public String getMemberStateCode() {
        return memberStateCode;
    }

    public void setMemberStateCode(String memberStateCode) {
        this.memberStateCode = memberStateCode;
    }

    public String getVatNumber() {
        return vatNumber;
    }

    public void setVatNumber(String vatNumber) {
        this.vatNumber = vatNumber;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidation.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidation extends VatValidationRequest implements Serializable {

    private Boolean valid;

    public VatValidation() {

    }

    public VatValidation(String memberStateCode, String vatNumber, Boolean valid) {
        super(memberStateCode, vatNumber);
        this.valid = valid;
    }

    public Boolean getValid() {
        return valid;
    }

    public void setValid(Boolean valid) {
        this.valid = valid;
    }

    public Boolean isValid() {
        return valid;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>build.gradle</code> to add <code>function-client</code> and <code>com.amazonaws:aws-java-sdk-lambda</code> dependencies:</p>
</div>
<div class="listingblock">
<div class="title">invoice/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-function-client"
runtime 'com.amazonaws:aws-java-sdk-lambda:1.11.285'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also modify <code>src/main/resources/application.yml</code> and the define a function with the same name <code>vies-vat-validator</code> as the one we deployed to AWS Lambda:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">aws:
  lambda:
    functions:
      vat:
        functionName: vies-vat-validator
        qualifer: vat
    region: eu-west-3 # Paris Region</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the next configuration properties which we will use shortly:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">vat:
  percentage: 0.21
  scale: 2
  retry:
    attempts: 5
    delay: 5s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>VatClient</code> to invoke our function:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.function.client.FunctionClient;
import io.micronaut.http.annotation.Body;
import io.micronaut.retry.annotation.Retryable;
import io.reactivex.Single;

import javax.inject.Named;

@FunctionClient <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(notEnv = Environment.TEST) <i class="conum" data-value="2"></i><b>(2)</b>
public interface VatClient extends VatValidator {

    @Override
    @Named("vies-vat-validator") <i class="conum" data-value="3"></i><b>(3)</b>
    @Retryable(attempts = "${vat.retry.attempts:3}", delay = "${vat.retry.delay:1s}") <i class="conum" data-value="4"></i><b>(4)</b>
    Single&lt;VatValidation&gt; validateVat(@Body VatValidationRequest req);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The FunctionClient annotation allows applying introduction advise to an interface such that methods defined by the interface become invokers of remote functions configured by the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can remove a bean from the test classpath easily.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the function name <code>vies-vat-validator</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>AWS Lambda functions may take time to warm up. Thus, failure is something you have to plan for and it is pretty common to want to attempt to retry an operation if it fails.
With <a href="https://docs.micronaut.io/snapshot/guide/index.html#retry">Micronaut Retry</a> you can try again easily.</td>
</tr>
</table>
</div>


<h2 id="controller">5.3 Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s validation is built on with the standard framework â€“ JSR 380, also known as Bean Validation 2.0.</p>
</div>
<div class="paragraph">
<p>Hibernate Validator is a reference implementation of the validation API. Starting with Micronaut 1.2, Micronaut
<a href="https://docs.micronaut.io/latest/guide/index.html#beanValidation">has built-in support for validation beans</a> that
are annotated with <code>javax.validation</code> annotations.</p>
</div>
<div class="paragraph">
<p>Add the next snippet to <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-validation"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/InvoiceController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Value;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.reactivex.Single;

import javax.validation.Valid;
import java.math.BigDecimal;

@Controller("/invoice") <i class="conum" data-value="1"></i><b>(1)</b>
public class InvoiceController {

    private final BigDecimal vatPercentage;

    private final VatValidator vatValidator;

    private final int scale;

    public InvoiceController(@Value("${vat.percentage}") BigDecimal vatPercentage, <i class="conum" data-value="2"></i><b>(2)</b>
                             @Value("${vat.scale}") int scale,
                             VatValidator vatValidator) { <i class="conum" data-value="3"></i><b>(3)</b>
        this.vatPercentage = vatPercentage;
        this.scale = scale;
        this.vatValidator = vatValidator;
    }

    @Post("/vat") <i class="conum" data-value="4"></i><b>(4)</b>
    Single&lt;Taxes&gt; calculateVat(@Valid @Body Invoice invoice) {  <i class="conum" data-value="5"></i><b>(5)</b>
        return vatValidator.validateVat(new VatValidationRequest(invoice.getCountryCode(), invoice.getVatNumber())) <i class="conum" data-value="6"></i><b>(6)</b>
                .map(vatValidation -&gt; {
                        BigDecimal percentage = vatValidation.isValid() ? vatPercentage : new BigDecimal("0");
                    return new Taxes(invoice.getLines().stream()
                            .map(line -&gt; line.vatPrice(percentage))
                            .reduce(BigDecimal.ZERO, BigDecimal::add)
                            .setScale(scale, BigDecimal.ROUND_HALF_EVEN));
                        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <code>@Controller</code> annotation mapped to the path <code>/invoice</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor injection of a configuration property.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection of a bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@Post</code> annotation is used to map the <code>calculateVat</code> method to all requests to <code>/invoice/vat</code> that use an HTTP POST.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add <code>@Valid</code> to any method parameter which requires validation. Use a POGO supplied as a JSON payload in the request to populate the invoice.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This invokes the function in AWS Lambda.</td>
</tr>
</table>
</div>


<h2 id="tests">5.4 Tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/tests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We don&#8217;t want the real AWS Lambda function executed in our tests.</p>
</div>
<div class="paragraph">
<p>Thus, create a bean to provide an implementation of <code>VatValidator</code> in the test phase:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/test/java/example/micronaut/VatValidatorMock.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.reactivex.Single;

import javax.inject.Singleton;
import java.util.Collections;
import java.util.List;

@Requires(env = Environment.TEST)
@Singleton
public class VatValidatorMock implements VatValidator {

    @Override
    public Single&lt;VatValidation&gt; validateVat(VatValidationRequest request) {
        String memberStateCode = request.getMemberStateCode();
        String vatNumber = request.getVatNumber();
        List&lt;String&gt; validVatNumbers = Collections.singletonList("B84965375");
        return Single.just(new VatValidation(memberStateCode,
                vatNumber,
                validVatNumbers.contains(vatNumber)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a JUnit test which verifies the logic:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/test/java/example/micronaut/InvoiceControllerTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
public class InvoiceControllerTest {

    @Inject
    @Client("/")
    RxHttpClient rxHttpClient; <i class="conum" data-value="2"></i><b>(2)</b>

    @Inject
    EmbeddedServer server; <i class="conum" data-value="3"></i><b>(3)</b>

    @Test
    public void testInvoiceController() {

        VatValidator bean = server.getApplicationContext().getBean(VatValidator.class);
        assertTrue(bean instanceof VatValidatorMock); <i class="conum" data-value="4"></i><b>(4)</b>

        List&lt;InvoiceLine&gt; lines = new ArrayList&lt;InvoiceLine&gt;();
        lines.add(new InvoiceLine("1491950358", 2, new BigDecimal(19.99)));
        lines.add(new InvoiceLine("1680502395", 1, new BigDecimal(15)));
        Invoice invoice = new Invoice("B84965375", "es", lines);
        HttpRequest request = HttpRequest.POST("/invoice/vat", invoice);
        Taxes rsp = rxHttpClient.toBlocking().retrieve(request, Taxes.class);
        BigDecimal expected = new BigDecimal("11.55");
        assertEquals(expected, rsp.getVat());

        invoice.setVatNumber("B99999999");
        rsp = rxHttpClient.toBlocking().retrieve(request, Taxes.class);
        expected = new BigDecimal("0.00");
        assertEquals(expected, rsp.getVat());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> to let Micronaut starts the embedded server and inject the beans. More info: <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>RxHttpClient</code> bean in the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the <code>EmbeddedServer</code> bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Verify the bean for interface <code>VatValidator</code> is <code>VatValidatorMock</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are curious about how the 11.55 is calculated.
Given a 21% VAT.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Line VAT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19,99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8,3958</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3,15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total VAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11,55</p></td>
</tr>
</tbody>
</table>


<h1 id="runningTheApp">6 Running the app</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The easiest way to configure credentials for invoking the function is to define a ~/.aws/credentials` file`.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[default]
aws_access_key_id=XXXXXXXXXXX
aws_secret_access_key=XXXXX</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the application use the <code>./gradlew run</code> command which will start the application on port 8080.</p>
</div>
<div class="paragraph">
<p>execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">curl -X "POST" "http://localhost:8080/invoice/vat" \
     -H 'Content-Type: application/json' \
     -d $'{
  "countryCode": "es",
  "vatNumber": "B86412491",
  "lines": [
    {
      "count": 2,
      "price": 19.99,
      "productId": "1491950358"
    },
    {
      "count": 1,
      "price": 15,
      "productId": "1680502395"
    }
  ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>and you will get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">{"vat":11.55}</code></pre>
</div>
</div>


<h1 id="awsApiGateway">7 AWS API Gateway</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/awsApiGateway.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> is a fully managed service that makes it easy for developers to create, publish,
maintain, monitor, and secure APIs at any scale.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A common use case of AWS API Gateway is to create HTTP endpoints which expose functions deploy to AWS Lambda.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create an endpoint which exposes the Micronaut function we deployed to AWS Lambda.</p>
</div>
<div class="paragraph">
<p>Create a new AWS Gateway API</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway1.png" alt="awsapigateway1">
</div>
</div>
<div class="paragraph">
<p>Create a POST method, with integration type <code>Lambda Function</code> and enter the Lambda function name you used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway2.png" alt="awsapigateway2">
</div>
</div>
<div class="paragraph">
<p>Create a Model for the incoming request to the method.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway3.png" alt="awsapigateway3">
</div>
</div>
<div class="paragraph">
<p>Edit the POST Method request and configure the Model as the content type.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway4.png" alt="awsapigateway4">
</div>
</div>
<div class="paragraph">
<p>You will be able to test the API method and its integration with the AWS Lambda function.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway5.png" alt="awsapigateway5">
</div>
</div>
<div class="paragraph">
<p>Deploy the API to create an endpoint which we can invoke with an HTTP request:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway6.png" alt="awsapigateway6">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway7.png" alt="awsapigateway7">
</div>
</div>
<div class="paragraph">
<p>You will get an invoke URL to use:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/awsapigateway8.png" alt="awsapigateway8">
</div>
</div>


<h2 id="awsApiGatewayUrlInMicronaut">7.1 Consume API Gateway URL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/awsApiGateway/awsApiGatewayUrlInMicronaut.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although we are not using a discovery server like Consul or Eureka, you can <a href="https://docs.micronaut.io/latest/guide/index.html#_client_specific_configuration">manually configure service discovery</a> in application.yml:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">micronaut:
  http:
    services:
      viesvatvalidator: <i class="conum" data-value="1"></i><b>(1)</b>
        urls:
          - "https://8ah5p89xof.execute-api.eu-west-3.amazonaws.com"
        stage: "beta"
  application:
    name: invoice
  server:
    port: 8080</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure service name, we will use name in <code>@Client</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a <a href="https://docs.micronaut.io/snapshot/guide/index.html#clientAnnotation">Micronaut declarative HTTP Client</a> to consume that endpoint:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/AwsApiGatewayVatClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Primary;
import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.retry.annotation.Retryable;
import io.reactivex.Single;

@Primary <i class="conum" data-value="1"></i><b>(1)</b>
@Client("viesvatvalidator") <i class="conum" data-value="2"></i><b>(2)</b>
@Requires(notEnv = Environment.TEST) <i class="conum" data-value="3"></i><b>(3)</b>
public interface AwsApiGatewayVatClient extends VatValidator {

    @Override
    @Retryable(attempts = "${vat.retry.attempts:3}", delay = "${vat.retry.delay:1s}")
    @Post("/${micronaut.http.services.viesvatvalidator.stage}") <i class="conum" data-value="4"></i><b>(4)</b>
    Single&lt;VatValidation&gt; validateVat(@Body VatValidationRequest req);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Given a common interface called <code>VatValidator</code>
that is implemented by multiple classes (<code>AwsApiGatewayVatClient</code>, <code>VatClient</code>) you can boost which bean is injection with <a href="https://docs.micronaut.io/snapshot/guide/index.html#_primary_and_secondary_beans">@Primary</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the service id you defined in <code>micronaut.http.services</code> configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can remove a bean from the test classpath easily.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define this as a POST request and interpolate a configuration property to define the path.</td>
</tr>
</table>
</div>


<h1 id="graal">8 Running the Function on Graal Native Image</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.graalvm.org/">GraalVM</a> is a new universal virtual machine from Oracle that supports a polyglot runtime environment and the ability to compile Java applications down to native machine code.</p>
</div>
<div class="paragraph">
<p>Any Micronaut application can be run using the GraalVM JVM, however special support has been added to Micronaut to support running Micronaut applications using <a href="https://www.graalvm.org/docs/reference-manual/aot-compilation/">GraalVMâ€™s nativeimage tool</a>.</p>
</div>
<div class="paragraph">
<p>We are going to modify the function project to be able to run it as Graal native image.</p>
</div>
<div class="paragraph">
<p>Create a copy of the function project.</p>
</div>
<div class="paragraph">
<p><code>$ cp -r vies-vat-validator vies-vat-validat-graal</code></p>
</div>
<div class="paragraph">
<p>Before the <code>jar</code> gradle task configure the <code>archivesBaseName</code> to be <code>vies-vat-validator</code>.</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator-graal/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">archivesBaseName = 'vies-vat-validator'
jar {
    manifest {
        attributes 'Main-Class': mainClassName
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following steps were required:</p>
</div>
<div class="sect2">
<h3 id="_1_install_graal">1. Install Graal</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">sdk install java 19.2.1-grl
sdk use java 19.2.1-grl
gu install native-image</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may need to be in the latest version of <a href="http://sdkman.io">sdkman.io</a> to see Graal as a java candidate.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_2_add_graal_dependencies">2. Add Graal dependencies</h3>
<div class="paragraph">
<p>Add the following to <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator-graal/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">compileOnly "com.oracle.substratevm:svm"
annotationProcessor "io.micronaut:micronaut-graal"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_create_code_native_image_properties_code_file">3. Create <code>native-image.properties</code> file</h3>
<div class="paragraph">
<p>Create the following file:</p>
</div>
<div class="listingblock">
<div class="title">vies-vat-validator-graal/src/main/resources/META-INF/native-image/example.micronaut/vies-vat-validator-application/native-image.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code>Args = -H:IncludeResources=logback.xml|application.yml \
       -H:Name=vies-vat-validator \
       -H:Class=io.micronaut.function.executor.FunctionApplication \
       --initialize-at-build-time=org.apache.logging.log4j,org.apache.logging.slf4j</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_annotate_pojo">4. Annotate POJO</h3>
<div class="paragraph">
<p>Annotate <code>VatValidationRequest.java</code> with <code>@Introspected</code> to generate compile time Bean introspection metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_build_the_function">5. Build the Function</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">vies-vat-validator-graal $ ./gradlew assemble</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_6_build_the_graal_native_image">6. Build the Graal Native Image</h3>
<div class="paragraph">
<p>Run the <code>native-image</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">native-image --no-server --class-path build/libs/vies-vat-validator-0.1-all.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_7_run_the_native_function">7. Run the Native Function</h3>
<div class="paragraph">
<p>The native function is now build. You can run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete/vies-vat-validator-graal $ time echo '{"memberStateCode":"es", "vatNumber":"B99286353"}' | ./vies-vat-validator
10:22:30.003 [main] DEBUG e.micronaut.ViesVatValidatorFunction - validate country: es vat number: B99286353
{"valid":true,"memberStateCode":"es","vatNumber":"B99286353"}
real    0m1.475s
user    0m0.017s
sys     0m0.034s
```</code></pre>
</div>
</div>
<div class="paragraph">
<p>For comparision, execute with the jar file we generated in the previous section of this tutorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete/vies-vat-validator $ time echo '{"memberStateCode":"es", "vatNumber":"B99286353"}' | java -jar build/libs/vies-vat-validator-0.1-all.jar
10:25:52.136 [main] DEBUG e.micronaut.ViesVatValidatorFunction - validate country: es vat number: B99286353
{"memberStateCode":"es","vatNumber":"B99286353","valid":true}
real    0m3.261s
user    0m8.430s
sys     0m0.723s</code></pre>
</div>
</div>
</div>


<h1 id="nextSteps">9 Next Steps</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/nextSteps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Read more about <a href="https://docs.micronaut.io/latest/guide/index.html#serverlessFunctions">Serverless Functions</a> inside Micronaut.</p>
</div>
<div class="paragraph">
<p>Learn more <a href="https://docs.micronaut.io/latest/guide/index.html#graal">Micronaut for GraalVM</a> integration.</p>
</div>


<h1 id="help">10 Help with Micronaut</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/help.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333;">OCI sponsored the creation of this Guide. OCI offers several <a href="https://objectcomputing.com/products/micronaut/">Micronaut services</a>:</h3>

<img src="../img/oci-micronaut-services.svg"/>

<h3>Free consultation </h3>

<!-- This is the code that is needed to run the form -->

<!--Copy and paste into the document's head or body.-->

<script type="text/javascript">

    /** This section is only needed once per page if manually copying **/
    if (typeof MauticSDKLoaded == 'undefined') {
        var MauticSDKLoaded = true;
        var head            = document.getElementsByTagName('head')[0];
        var script          = document.createElement('script');
        script.type         = 'text/javascript';
        script.src          = 'https://mautic.objectcomputing.com/media/js/mautic-form.js';
        script.onload       = function() {
            MauticSDK.onLoad();
        };
        head.appendChild(script);
        var MauticDomain = 'https://mautic.objectcomputing.com';
        var MauticLang   = {
            'submittingMessage': "Please wait..."
        }
    }
</script>

<!--Copy and paste into the document's body.-->

<style type="text/css" scoped>
    .mauticform_wrapper { max-width: 600px; margin: 10px auto; }
    .mauticform-innerform {}
    .mauticform-post-success {}
    .mauticform-name { font-weight: bold; font-size: 1.5em; margin-bottom: 3px; }
    .mauticform-description { margin-top: 2px; margin-bottom: 10px; }
    .mauticform-error { margin-bottom: 10px; color: red; }
    .mauticform-message { margin-bottom: 10px;color: green; }
    .mauticform-row { display: block; margin-bottom: 20px; }
    .mauticform-label { font-size: 1.1em; display: block; font-weight: bold; margin-bottom: 5px; }
    .mauticform-row.mauticform-required .mauticform-label:after { color: #e32; content: " *"; display: inline; }
    .mauticform-helpmessage { display: block; font-size: 0.9em; margin-bottom: 3px; }
    .mauticform-errormsg { display: block; color: red; margin-top: 2px; }
    .mauticform-selectbox, .mauticform-input, .mauticform-textarea { width: 100%; padding: 0.5em 0.5em; border: 1px solid #CCC; background: #fff; box-shadow: 0px 0px 0px #fff inset; border-radius: 4px; box-sizing: border-box; }
    .mauticform-checkboxgrp-row {}
    .mauticform-checkboxgrp-label { font-weight: normal; }
    .mauticform-checkboxgrp-checkbox {}
    .mauticform-radiogrp-row {}
    .mauticform-radiogrp-label { font-weight: normal; }
    .mauticform-radiogrp-radio {}
    .mauticform-button-wrapper .mauticform-button.btn-default, .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default { font-size: 14px; color: #fff;background-color: #feb672 ;border-color: #dddddd; padding: 15px 30px;}
    .mauticform-button-wrapper .mauticform-button, .mauticform-pagebreak-wrapper .mauticform-pagebreak { display: inline-block;margin-bottom: 0;font-weight: 600;text-align: center;vertical-align: middle;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 13px;line-height: 1.3856;border-radius: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}
    .mauticform-button-wrapper .mauticform-button.btn-default[disabled], .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default[disabled] { background-color:#feb672; border-color: #dddddd; opacity: 0.75; cursor: not-allowed; font-size: 14px; color: #fff; padding: 15px 30px;}
    .mauticform-pagebreak-wrapper .mauticform-button-wrapper {  display: inline; }
</style>
<div id="mauticform_wrapper_grailsorgconsultationform" class="mauticform_wrapper">
    <form autocomplete="false" role="form" method="post" action="https://mautic.objectcomputing.com/form/submit?formId=3" id="mauticform_grailsorgconsultationform" data-mautic-form="grailsorgconsultationform">

        <div class="mauticform-innerform">

          <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

            <div id="mauticform_grailsorgconsultationform_first_name"  data-validate="first_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-1 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_first_name" name="mauticform[first_name]" value="" placeholder="First Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_last_name"  data-validate="last_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-2 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_last_name" name="mauticform[last_name]" value="" placeholder="Last Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-3 mauticform-required col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_email" name="mauticform[email]" value="" placeholder="Email *" class="mauticform-input" type="email" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_phone"  class="mauticform-row mauticform-tel mauticform-field-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_phone" name="mauticform[phone]" value="" placeholder="Phone" class="mauticform-input" type="tel" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_company"  class="mauticform-row mauticform-text mauticform-field-5 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_company" name="mauticform[company]" value="" placeholder="Company" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-6" style="">
                <button type="submit" name="mauticform[submit]" id="mauticform_input_grailsorgconsultationform_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1" style="border: none; margin-left: 14px;">SUBMIT</button>
            </div>
            </div>
        </div>

        <input type="hidden" name="mauticform[formId]" id="mauticform_grailsorgconsultationform_id" value="3"/>
        <input type="hidden" name="mauticform[return]" id="mauticform_grailsorgconsultationform_return" value=""/>
        <input type="hidden" name="mauticform[formName]" id="mauticform_grailsorgconsultationform_name" value="grailsorgconsultationform"/>
</form>
</div>

<!--The code below is the message that appears when someone hits submit. Feel free to style this how you see fit for Grails.org. All CSS is handled in the above code.-->

<div class="mauticform-error" id="mauticform_grailsorgconsultationform_error"></div>
<div class="mauticform-message" id="mauticform_grailsorgconsultationform_message"></div>

<h3 style="color: #333;">The <a href="https://objectcomputing.com/products/micronaut">OCI Micronaut Team</a>
includes Micronaut co-founders, <b>Jeff Scott Brown and Graeme Rocher</b>.
Check our <a href="https://objectcomputing.com/services/training/catalog/micronaut-training">Micronaut courses</a> and learn from the engineers who developed,
matured and maintain Micronaut.</h3>

<img src="../img/ocigrailsteam.png" style="max-width: 748px; width: 100%;" alt="Micronaut OCI Team">

</article>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115754405-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-115754405-1');
</script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5.1 Creating GraalVM native image null</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Creating your first Micronaut Graal application
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/writingTheApp.html"><strong>2</strong><span>Writing the App</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/service.html"><strong>3</strong><span>Service</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/controller.html"><strong>4</strong><span>Controller</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/graal.html"><strong>5</strong><span>Adding GraalVM support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/nextSteps.html"><strong>6</strong><span>Next steps</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/help.html"><strong>7</strong><span>Help with Micronaut</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/controller.html">&lt;&lt; <strong>4</strong><span>Controller</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/nextSteps.html"><strong>6</strong><span>Next steps</span> >></a></div>
                


                <div class="project">
                    <h1>5.1 Creating GraalVM native image</h1>

                    <p><strong>Version:</strong> null</p>
                </div>

                

                

<h2 id="creatingGraalImage">5.1 Creating GraalVM native image</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-creating-first-graal-app/edit/master/src/main/docs/guide/graal/creatingGraalImage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When we created the application we used the <code>graalvm</code> feature. This feature adds three important items:</p>
</div>
<div class="paragraph">
<p>1.- <code>svm</code> and <code>graal</code> dependencies in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">compileOnly("org.graalvm.nativeimage:svm")
annotationProcessor("io.micronaut:micronaut-graal")  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotation processor to generate the <code>reflection</code> and <code>resources</code> information at compile time.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>2.- A <code>Dockerfile</code> which can be used to construct the native image executing <code>docker-build.sh</code></p>
</div>
<div class="paragraph">
<p>3.- A <code>native-image.properties</code> file in <code>resources/META-INF/native-image/example.micronaut/complete-application</code> directory with
Graal&#8217;s <code>native-image</code> configuration. This file can be used to fine tune the native-image generation.</p>
</div>
<div class="listingblock">
<div class="title">native-image.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code>Args = -H:Name=micronaut-graal-app \
       -H:Class=example.micronaut.Application</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_creating_native_image_inside_docker">Creating native image inside Docker</h3>
<div class="paragraph">
<p>With this approach you only need to build the fatjar and then use Docker to build the native image.</p>
</div>
<div class="listingblock">
<div class="title">Building Graal native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./gradlew assemble
$ ./docker-build.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command will create the image <code>micronaut-graal-app:latest</code>. To execute it:</p>
</div>
<div class="listingblock">
<div class="title">Executing the native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker run -p 8080:8080 micronaut-graal-app
10:29:46.845 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 12ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the application starts in only 12ms.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_native_image_outside_docker">Creating native image outside Docker</h3>
<div class="paragraph">
<p>To build your native image without using Docker you need to install GraalVM SDK via the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a> instructions or using SDKman:</p>
</div>
<div class="listingblock">
<div class="title">Installing GraalVM 20.2.0 with SDKman</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sdk install java 20.2.0.r8-grl
$ sdk use java 20.2.0.r8-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>native-image</code> tool was extracted from the base GraalVM distribution. Currently it is available as an early adopter plugin. To install it, run:</p>
</div>
<div class="listingblock">
<div class="title">Installing <code>native-image</code> tool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ gu install native-image <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You only need to do that the first time to install the <code>native-image</code> tool.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Building Graal native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sdk use java 20.2.0.r8-grl
$ ./gradlew assemble
$ native-image -cp build/libs/complete-*-all.jar <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Starting in Micronaut 1.1.0 it is really simple to create the native image.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command will create a native executable called <code>micronaut-graal-app</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sending_a_request">Sending a request</h3>
<div class="paragraph">
<p>Start the application either using Docker or the native executable. You can run a few cURL requests to test the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete $ time curl localhost:8080/conferences/random
{"name":"Greach"}
real    0m0.016s
user    0m0.005s
sys     0m0.004s

complete $ time curl localhost:8080/conferences/random
{"name":"GR8Conf EU"}
real    0m0.014s
user    0m0.005s
sys     0m0.004s</code></pre>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/controller.html">&lt;&lt; <strong>4</strong><span>Controller</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/nextSteps.html"><strong>6</strong><span>Next steps</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
